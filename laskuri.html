<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Laskuri työntekijälle</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Roboto", sans-serif;
        }
        .custom-green {
            background-color: rgb(0, 66, 37);
        }
        .custom-green-lighter {
            background-color: rgb(0, 105, 63);
        }
        @media (max-width: 580px) {
            .custom-margin {
                margin-top: 100px;
            }
        }
        @media (max-width: 400px) {
            .custom-margin {
                margin-top: 180px;
            }
        }
        @media (max-width: 360px) {
            .custom-margin {
                margin-top: 230px;
            }
        }
        @media (max-width: 440px) {
            .custom-padding {
                padding: 0px;
            }
        }
        td {
            padding: 4px;
        }
        .custom-border {
            border-top: 1px solid rgb(16, 16, 16);
        }
    </style>
</head>

<body class="bg-gray-100 md:flex justify-center items-center h-screen m-0">
    <div class="bg-white sm:p-4 rounded-xl shadow-lg max-w-3xl w-full">
        <div>
            <img class="inline-block p-8"
                src="https://ik.imagekit.io/tterimaa/taustaton%20logo-musta.png_7BxpEqhH_.png?updatedAt=1718457962794">
            <h2 class="text-3xl font-bold mb-6 text-center">
                Laskuri työntekijälle
            </h2>
        </div>
        </h2>
        <p class="text-center p-4 mb-6">
            Tällä laskurilla sinun on helppo arvioida Elite Bike Pyöräedulla saamaasi
            hyötyä verrattuna saman pyörän hankkimiseen ilman pyöräetua
        </p>

        <div class="flex flex-col sm:flex-row justify-between items-center mb-8 p-4">
            <label class="flex-1 mx-2 w-full">
                Pyörän hinta varusteineen
                <input type="range" id="bikePrice" min="1200" max="4000" step="50" value="2000" class="w-full" />
                <span id="bikePriceValue" class="block mt-2 text-center text-lg"></span>
            </label>
            <label class="flex-1 mx-2 w-full">
                Kuukausipalkkasi
                <input type="range" id="monthlySalary" min="1000" max="10000" step="100" value="3200" class="w-full" />
                <span id="monthlySalaryValue" class="block mt-2 text-center text-lg">3200 €/kk</span>
            </label>
        </div>

        <div class="flex flex-col sm:flex-row justify-between text-white">
            <div class="text-center flex-1 p-6 sm:m-2 custom-green sm:rounded-xl">
                <h3 class="text-2xl font-semibold">Säästö</h3>
                <p id="savingsAmount" class="text-3xl font-bold mt-2"></p>
                <p id="savingsPercentage" class="mt-2">30%</p>
            </div>
            <div class="text-center flex-1 p-6 sm:m-2 custom-green-lighter sm:rounded-xl">
                <h3 class="text-2xl  font-semibold">Pyörän kustannus</h3>
                <p id="finalCost" class="text-3xl font-bold mt-2">690 €</p>
                <p id="startCost" class="mt-2 line-through">2000 €</p>
            </div>
        </div>
        
        <div class="bg-gray-200 sm:rounded-xl sm:m-2 p-6 sm:p-4">
            <table class="w-full border-spacing-1">
                <tr>
                    <td>Vuokra-aika:</td>
                    <td><span id="rentalPeriod"></span></td>
                </tr>
                <tr>
                    <td>Vähennykset bruttopalkasta yhteensä:</td>
                    <td><span id="salaryDeduction"></span></td>
                </tr>
                <tr>
                    <td>Pyöräedun vaikutus tuloveroihin:</td>
                    <td><span id="taxSavings"></span></td>
                </tr>
                <tr>
                    <td>Pyörän lunastushinta lopuksi (5%):</td>
                    <td><span id="purchasePrice"></span></td>
                </tr>
                <tr>
                    <td>Kokonaiskustannus:</td>
                    <td><span id="totalCostInfo"></span></td>
                </tr>
                <tr>
                    <td>Pyörän hankintahinta varusteineen:</td>
                    <td><span id="bikePriceInfo"></span></td>
                </tr>
                <tr class="custom-border font-bold">
                    <td>Säästö pyöräedulla: </span></td>
                    <td><span id="savingsInfo"></span></td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        const bikePriceSlider = document.getElementById("bikePrice");
        const monthlySalarySlider = document.getElementById("monthlySalary");
        const bikePriceValue = document.getElementById("bikePriceValue");
        const bikePriceValues = document.getElementsByClassName("bikePriceValue")
        const rentalPeriodValue = document.getElementById("rentalPeriod");
        const monthlySalaryValue = document.getElementById("monthlySalaryValue");
        const finalCost = document.getElementById("finalCost");
        const startCost = document.getElementById("startCost");
        const salaryDeduction = document.getElementById("salaryDeduction");
        const purchasePrice = document.getElementById("purchasePrice");
        const savingsAmount = document.getElementById("savingsAmount");
        const savingsPercentage = document.getElementById("savingsPercentage");
        const taxSavingsValue = document.getElementById("taxSavings");
        const bikePriceInfoValue = document.getElementById("bikePriceInfo");
        const totalCostInfoValue = document.getElementById("totalCostInfo");
        const savingsInfoValue = document.getElementById("savingsInfo");

        function calculateLeasingPeriod(price) {
            if (price <= 650) return 12;
            else if (price <= 700) return 12;
            else if (price <= 750) return 12;
            else if (price <= 800) return 12;
            else if (price <= 850) return 12;
            else if (price <= 900) return 12;
            else if (price <= 950) return 12;
            else if (price <= 1000) return 12;
            else if (price <= 1050) return 12;
            else if (price <= 1100) return 13;
            else if (price <= 1150) return 13;
            else if (price <= 1200) return 14;
            else if (price <= 1250) return 15;
            else if (price <= 1300) return 15;
            else if (price <= 1350) return 16;
            else if (price <= 1400) return 16;
            else if (price <= 1450) return 17;
            else if (price <= 1500) return 17;
            else if (price <= 1550) return 18;
            else if (price <= 1600) return 19;
            else if (price <= 1650) return 19;
            else if (price <= 1700) return 20;
            else if (price <= 1750) return 21;
            else if (price <= 1800) return 21;
            else if (price <= 1850) return 22;
            else if (price <= 1900) return 22;
            else if (price <= 1950) return 23;
            else if (price <= 2000) return 24;
            else if (price <= 2050) return 24;
            else if (price <= 2100) return 25;
            else if (price <= 2150) return 25;
            else if (price <= 2200) return 26;
            else if (price <= 2250) return 27;
            else if (price <= 2300) return 27;
            else if (price <= 2350) return 28;
            else if (price <= 2400) return 29;
            else if (price <= 2450) return 29;
            else if (price <= 2500) return 30;
            else if (price <= 2550) return 31;
            else if (price <= 2600) return 31;
            else if (price <= 2650) return 32;
            else if (price <= 2700) return 33;
            else if (price <= 2750) return 33;
            else if (price <= 2800) return 34;
            else if (price <= 2850) return 35;
            else if (price <= 2900) return 35;
            else if (price <= 2950) return 36;
            else if (price <= 3000) return 37;
            else if (price <= 3050) return 37;
            else if (price <= 3100) return 38;
            else if (price <= 3150) return 39;
            else if (price <= 3200) return 39;
            else if (price <= 3250) return 40;
            else if (price <= 3300) return 41;
            else if (price <= 3350) return 42;
            else if (price <= 3400) return 42;
            else if (price <= 3450) return 43;
            else if (price <= 3500) return 44;
            else if (price <= 3550) return 45;
            else if (price <= 3600) return 45;
            else if (price <= 3650) return 46;
            else if (price <= 3700) return 47;
            else if (price <= 3750) return 48;
            else if (price <= 3800) return 49;
            else if (price <= 3850) return 49;
            else if (price <= 3900) return 50;
            else if (price <= 3950) return 51;
            else if (price <= 4000) return 52;
            else if (price <= 4050) return 53;
            else if (price <= 4100) return 54;
            else if (price <= 4150) return 54;
            else if (price <= 4200) return 55;
            else if (price <= 4250) return 56;
            else if (price <= 4300) return 57;
            else if (price <= 4350) return 58;
            else if (price <= 4400) return 59;
            else if (price <= 4450) return 59;
            else return 60;
        }
        
        function tulonhankkimisvahennys() {
            return 750;
        }

        function ansiotulovahennys(income) {
            let vahennys = 0;
            if (income > 2500) {
                vahennys += 0.51*(7230-2500);
            }
            if (income > 7230) {
                vahennys += 0.28*(14000-7230);
            }
            if (income > 14000) {
                vahennys -= 0.045*(income-14000);;
                vahennys = Math.max(vahennys, 0);
            }
            return Math.min(vahennys, 3570);
        }

        function tyel(income) {
            const val = 0.0715*income;
            console.log("TyEL: " + val);
            return val;
        }
        
        function tyottomyysVakuutus(income) {
            const val = 0.0079*income;
            console.log("Työttömyysvakuutus: " + val);
            return val;
        }

        function sairausPaivaraha(income) {
            let val = 0;
            if (income >= 16499) {
                val = 0.0101*income;
            }
            console.log("Sairausvakuutus: " + val);
            return val;
        }
        
        function vakuutusVahennykset(income) {
            const val = tyel(income) + tyottomyysVakuutus(income) + sairausPaivaraha(income);
            return val;
        }
        
        function tyotuloVahennys(income) {
            const val = Math.min(2140, 0.12*income);
            const pureIncome = income - tulonhankkimisvahennys();
            const excess1 = Math.max(pureIncome - 23420, 0);
            const excess2 = Math.max(pureIncome - 71900, 0);
            const vahennys = Math.min(2140, val-0.0203*excess1-0.00121*excess2);
            console.log("Työtulovähennys: " + vahennys);
            return val;
        }

        function perusVahennys(incomeAfterDeductions) {
            if (incomeAfterDeductions >= 29092) {
                return 0;
            }
            if (incomeAfterDeductions <= 3980) {
                return incomeAfterDeductions
            }
            const excess = incomeAfterDeductions - 3980;
            const val = 3980 - 0.18*excess;
            return Math.max(0, val);
        }

        function calculateTaxableSalary(yearlySalary, bikeDeduction) {
            const afterDeductions = yearlySalary - tulonhankkimisvahennys() - vakuutusVahennykset(yearlySalary) - ansiotulovahennys(yearlySalary + bikeDeduction);
            const pv = perusVahennys(afterDeductions);
            console.log("Perusvahennys: " + pv);
            return Math.max(0, afterDeductions - pv);
        }

        function incomeTax(taxableSalary) {
            let taxes = 0;
            taxes += Math.min(20500, taxableSalary) * 0.1264;
            taxes += Math.max(0, Math.min(30500, taxableSalary - 20500) * 0.19);
            taxes += Math.max(0, Math.min(50400, taxableSalary - 30500) * 0.3025);
            taxes += Math.max(0, Math.min(88200, taxableSalary - 88200) * 0.34);
            taxes += Math.max(0, Math.min(150000, taxableSalary - 150000) * 0.42);
            taxes += Math.max(0, taxableSalary - 150000) * 0.44;
            return Math.max(0, taxes);
        }

        function calculateTaxes(yearlySalary, bikeDeduction) {
            const taxableSalary = calculateTaxableSalary(yearlySalary, bikeDeduction);
            const taxes = incomeTax(taxableSalary);
            const tv = tyotuloVahennys(yearlySalary);
            const totalTax = Math.max(0, taxes - tv);
            return totalTax;
        }

        function updateValues() {
            const bikePrice = parseInt(bikePriceSlider.value);
            const monthlySalary = parseInt(monthlySalarySlider.value);
            const purchasePercentage = 0.05;

            // Calculate rental period
            const rentalPeriod = calculateLeasingPeriod(bikePrice);

            // Calulate total cost for leased bike
            const monthlyLeasingPayment = 100;
            const totalBikePrice = monthlyLeasingPayment * rentalPeriod;

            console.log("--------------------");
            // Calculate taxes with normal income
            const yearlySalary = monthlySalary * 12.5;
            const taxes = calculateTaxes(yearlySalary, 0);
            console.log("Taxes: " + taxes);

            // Calculate taxes with bike deduction
            const yearlyDeduction = monthlyLeasingPayment * 12;
            const taxesWithDeduction = calculateTaxes(yearlySalary-yearlyDeduction, yearlyDeduction);
            console.log("Taxes with deduction: " + taxesWithDeduction);

            // Calculate yearly savings
            const yearlySavings = taxes - taxesWithDeduction;

            // Calculate total savings
            const fullYears = Math.floor(rentalPeriod / 12);
            let totalSavings = yearlySavings  / 12 * rentalPeriod;

            // Calculate tax percentage for remaining year
            //const remainingMonths = rentalPeriod % 12;
            //const incomeDeductedForRemainingYear = yearlySalary - remainingMonths * monthlyLeasingPayment; // could be +-50
            //const taxForRemainingYear = getTaxPercentage(incomeDeductedForRemainingYear) - tyelEtc;
            //const taxSavingsForRemainingYear = (yearlySalary * incomeTax * 0.01) - (yearlySalary * taxForRemainingYear * 0.01);
            //totalSavings += taxSavingsForRemainingYear;

            bikePriceValue.textContent = `${bikePrice} €`;
            monthlySalaryValue.textContent = `${monthlySalary} €/kk`;
            rentalPeriodValue.textContent = `${rentalPeriod} kk`;
            startCost.textContent = `${bikePrice} €`;

            const salaryDeductionValue = monthlyLeasingPayment * rentalPeriod;
            const purchasePriceValue = bikePrice * purchasePercentage;
            const finalCostValue = totalBikePrice - totalSavings + purchasePriceValue;
            const savings = bikePrice - finalCostValue;
            const totalCostValue = finalCostValue + purchasePriceValue;

            salaryDeduction.textContent = `${salaryDeductionValue.toFixed(0)} €`;
            purchasePrice.textContent = `+${purchasePriceValue.toFixed(0)} €`;
            finalCost.textContent = `${finalCostValue.toFixed(0)} €`;
            savingsAmount.textContent = `${savings.toFixed(0)} €`;
            savingsPercentage.textContent = `${((savings / bikePrice) * 100).toFixed(0)}%`;
            taxSavingsValue.textContent = `-${totalSavings.toFixed(0)} €`;
            bikePriceInfoValue.textContent = `${bikePrice} €`;
            totalCostInfoValue.textContent = `${finalCostValue.toFixed(0)} €`;
            savingsInfoValue.textContent = `${savings.toFixed(0)} €`;
        }

        bikePriceSlider.addEventListener("input", updateValues);
        monthlySalarySlider.addEventListener("input", updateValues);

        updateValues();
    </script>
</body>

</html>